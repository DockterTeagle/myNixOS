#!/bin/sh
# first time
if [[ ! -d $(nix store add-path --name source --dry-run .) ]]; then
  nix store add-path --name source .
  (cd ./nix/repo&& nix flake update std)
  # (cd ./src/tests && nix flake lock --update-input std)
fi
#
. "$(fetchurl "https://raw.githubusercontent.com/paisano-nix/direnv/main/lib" "sha256-IgQhKK7UHL1AfCUntJO2KCaIDJQotRnK2qC4Daxk+wI=")"
watch_file ./flake.nix
use envreload //repo/devshells/default //repo/configs //repo/toolchain
layout_fish() {
    # register std completions via carapace
     std _carapace | source
}

# When leaving the environment
unlayout_fish() {
    # remove completions
    complete -c std -r
}
